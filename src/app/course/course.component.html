<div class="container mt-4">
  <!-- Create/Edit Course Form (hidden in listMode) -->
  <div *ngIf="!listMode" class="mb-5">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">{{ isEditMode ? 'Edit Course' : 'Create Course' }}</h4>
      </div>
      <div class="card-body">
        <form [formGroup]="courseForm" (ngSubmit)="isEditMode ? updateCourse() : createCourse()">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" formControlName="title" class="form-control">
                <div *ngIf="courseForm.get('title')?.invalid && courseForm.get('title')?.touched" class="text-danger small">
                  Title is required.
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="category">Category</label>
                <select id="category" formControlName="category" class="form-control">
                  <option value="">Select category</option>
                  <option value="Cloud">Cloud</option>
                  <option value="DevOps">DevOps</option>
                  <option value="Programming">Programming</option>
                  <option value="Data">Data</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" formControlName="description" class="form-control" rows="3"></textarea>
            <div *ngIf="courseForm.get('description')?.invalid && courseForm.get('description')?.touched" class="text-danger small">
              Description is required.
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <div class="form-group">
                <label for="durationInHours">Duration (hours)</label>
                <input type="number" min="0.5" step="0.5" id="durationInHours" formControlName="durationInHours" class="form-control">
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label for="level">Level</label>
                <select id="level" formControlName="level" class="form-control">
                  <option>Beginner</option>
                  <option>Intermediate</option>
                  <option>Advanced</option>
                </select>
              </div>
            </div>
            <div class="col-md-4 d-flex align-items-end">
              <div class="form-check mb-3">
                <input type="checkbox" id="published" formControlName="published" class="form-check-input">
                <label for="published" class="form-check-label">Published</label>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Course Thumbnail</label><br />
                <button type="button" class="btn btn-outline-primary rounded-pill px-3 py-2" (click)="createThumbnailInput.click()">
                  <i class="ti-image mr-2"></i> Choose Thumbnail
                </button>
                <input #createThumbnailInput type="file" accept="image/*" (change)="onCreateThumbnailSelected($event)" style="display: none;">
                <p *ngIf="createThumbnailFile" class="text-muted small mt-1">Selected: {{ createThumbnailFile.name }}</p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Course Video</label><br />
                <button type="button" class="btn btn-outline-success rounded-pill px-3 py-2" (click)="createVideoInput.click()">
                  <i class="ti-video-camera mr-2"></i> Choose Video
                </button>
                <input #createVideoInput type="file" accept="video/*" (change)="onCreateVideoSelected($event)" style="display: none;">
                <p *ngIf="createVideoFile" class="text-muted small mt-1">Selected: {{ createVideoFile.name }}</p>
              </div>
            </div>
          </div>

          <input type="text" id="teacherId" formControlName="teacherId" class="form-control" [value]="userId ? userId : ''" readonly hidden>

          <div class="mt-4">
            <button type="submit" class="btn btn-primary px-4 py-2">
              <i class="ti-save mr-2"></i> {{ isEditMode ? 'Update Course' : 'Create Course' }}
            </button>
            <button type="button" class="btn btn-outline-secondary ml-2 px-4 py-2" (click)="clearForm()">
              <i class="ti-reload mr-2"></i> Clear
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Courses List -->
  <div>
    <h3 class="mb-4">
      <i class="ti-book"></i> Courses
      <span class="badge badge-secondary ml-2">{{ courses.length }}</span>
    </h3>
    <div *ngIf="courses.length === 0" class="alert alert-info">No courses available.</div>
    <div class="row">
      <div *ngFor="let course of courses" class="col-lg-6 col-xl-4 mb-4">
        <div class="card h-100 shadow-sm border-0">
          <img *ngIf="course.imageUrl" [src]="course.imageUrl" class="card-img-top" [alt]="course.title" style="height: 180px; object-fit: cover;">
          <div *ngIf="!course.imageUrl" class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 180px;">
            <i class="ti-image" style="font-size: 3rem; color: #ccc;"></i>
          </div>
          <div class="card-body d-flex flex-column">
            <!-- View Mode -->
            <div *ngIf="!isEditingInline(course.id)">
              <h5 class="card-title"><strong>Title:</strong> {{ course.title }}</h5>
              <p class="card-text text-muted"><strong>Description:</strong> {{ course.description }}</p>
              <div class="mb-2">
                <span class="badge badge-info">{{ course.category }}</span>
                <span class="badge badge-secondary ml-1">{{ course.level }}</span>
                <!-- Status toggle switch -->
                <div class="d-inline-block ml-2 align-middle">
                  <label class="status-switch mb-0">
                    <input type="checkbox" [checked]="course.published" (change)="toggleCourseStatus(course)">
                    <span class="slider round"></span>
                  </label>
                  <small class="ml-2 text-muted">{{ course.published ? 'Public' : 'Private' }}</small>
                </div>
              </div>
              <p class="small mb-2"><i class="ti-time"></i> {{ course.durationInHours }} hours</p>
              <!-- Video availability in view mode -->
              <div class="mb-2">
                <div *ngIf="course.videoUrl" class="text-success small">
                  <i class="ti-video-camera mr-1"></i>
                  <a [href]="course.videoUrl" target="_blank" class="text-success">Watch Video</a>
                </div>
                <div *ngIf="!course.videoUrl" class="text-muted small">
                  <i class="ti-video-camera-off mr-1"></i> No video available
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="isEditingInline(course.id)" [formGroup]="inlineEditForm" class="edit-mode-section p-3 bg-light rounded">
              <div class="mb-3">
                <label class="form-label small text-muted"><i class="ti-pencil-alt mr-1"></i>Edit Title</label>
                <input type="text" class="form-control" formControlName="title" placeholder="Enter course title">
              </div>
              <div class="mb-3">
                <label class="form-label small text-muted"><i class="ti-pencil-alt mr-1"></i>Edit Description</label>
                <textarea class="form-control" rows="3" formControlName="description" placeholder="Enter course description"></textarea>
              </div>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label small text-muted"><i class="ti-tag mr-1"></i>Category</label>
                  <select class="form-control" formControlName="category">
                    <option value="">Select category</option>
                    <option value="Cloud">Cloud</option>
                    <option value="DevOps">DevOps</option>
                    <option value="Programming">Programming</option>
                    <option value="Data">Data</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted"><i class="ti-layers mr-1"></i>Level</label>
                  <select class="form-control" formControlName="level">
                    <option>Beginner</option>
                    <option>Intermediate</option>
                    <option>Advanced</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted"><i class="ti-time mr-1"></i>Duration (hours)</label>
                  <input type="number" min="0.5" step="0.5" class="form-control" formControlName="durationInHours">
                </div>
              </div>
              <div class="mb-3">
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="published-{{course.id}}" formControlName="published">
                  <label class="form-check-label" for="published-{{course.id}}">
                    <i class="ti-world mr-1"></i>Published
                  </label>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label small text-muted"><i class="ti-upload mr-1"></i>Media</label>
                <div>
                  <button type="button" class="btn btn-outline-primary btn-sm rounded-pill me-2" (click)="thumbnailInput.click()">
                    <i class="ti-image mr-1"></i> Thumbnail
                  </button>
                  <input #thumbnailInput type="file" accept="image/*" (change)="onThumbnailFileSelected(course.id, $event)" style="display: none;">
                  <button type="button" class="btn btn-outline-success btn-sm rounded-pill" (click)="fileInput.click()">
                    <i class="ti-video-camera mr-1"></i> Video
                  </button>
                  <input #fileInput type="file" accept="video/*" (change)="onVideoFileSelected(course.id, $event)" style="display: none;">
                </div>
                <div *ngIf="course.videoUrl" class="mt-2">
                  <a [href]="course.videoUrl" target="_blank" class="btn btn-sm btn-info rounded-pill">
                    <i class="ti-video-camera mr-1"></i> Watch Video
                  </a>
                </div>
              </div>
            </div>
            <div class="mt-auto">
              <div>
                <button (click)="toggleInlineEdit(course.id)" class="btn btn-sm rounded-pill px-3 py-1"
                        [class.btn-warning]="!isEditingInline(course.id)"
                        [class.btn-success]="isEditingInline(course.id)">
                  <i class="ti-pencil mr-1" *ngIf="!isEditingInline(course.id)"></i>
                  <i class="ti-check mr-1" *ngIf="isEditingInline(course.id)"></i>
                  {{ isEditingInline(course.id) ? 'Done' : 'Edit' }}
                </button>
                <button (click)="deleteCourse(course.id)" class="btn btn-sm btn-danger rounded-pill px-3 py-1 ml-2">
                  <i class="ti-trash mr-1"></i> Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup de succès de création de cours -->
  <div class="course-success-overlay" *ngIf="createSuccessMessage">
    <div class="course-success-modal">
      <div class="course-success-icon-wrap">
        <div class="course-success-icon">✓</div>
      </div>
      <h4 class="course-success-title">Course Created</h4>
      <p class="course-success-text">{{ createSuccessMessage }}</p>
      <button type="button" class="course-success-button" (click)="onCreateSuccessOk()">
        OK
      </button>
    </div>
  </div>
</div>
