import{Q as n,V as u,gc as f,m as i,p as o,z as l}from"./chunk-TON6CJEA.js";var I=(()=>{class g{http;apiUrl="http://localhost:8082/api/auth";constructor(a){this.http=a}login(a,t){return this.http.post(`${this.apiUrl}/login`,{email:a,password:t}).pipe(o(e=>{if(e.message&&!e.token)throw new Error(e.message);if(localStorage.setItem("jwtToken",e.token),localStorage.setItem("userId",e.userId),localStorage.setItem("role",e.role),localStorage.setItem("email",a),e.username)localStorage.setItem("username",e.username);else{let s=a.split("@")[0],r=s.charAt(0).toUpperCase()+s.slice(1);localStorage.setItem("username",r)}return e}),l(e=>{let s="Login failed. Please try again.";return e.error&&(e.error.message?s=e.error.message:typeof e.error=="string"&&(s=e.error)),i(()=>({message:s,status:e.status}))}))}register(a,t,e,s="STUDENT"){return this.http.post(`${this.apiUrl}/register`,{username:a,email:t,password:e,role:s}).pipe(o(r=>{if(r&&r.success)return localStorage.setItem("pendingVerificationEmail",t),r;throw new Error(r?.message||"Registration failed. Please try again.")}),l(r=>{let m="Registration failed. Please try again.";return r.error?r.error.message?m=r.error.message:typeof r.error=="string"&&(m=r.error):r.message&&(m=r.message),i(()=>({message:m,status:r.status,error:r.error}))}))}verifyEmail(a,t){return this.http.post(`${this.apiUrl}/verify-email`,{email:a,verificationCode:t}).pipe(o(e=>typeof e=="string"?{message:e,success:!0}:e&&typeof e=="object"?e:{message:"Email verified successfully!",success:!0}),l(e=>{let s="Verification failed. Please try again.";return e.error&&(typeof e.error=="string"?s=e.error:(e.error.message||e.error instanceof Object&&"message"in e.error)&&(s=e.error.message)),i(()=>({message:s,status:e.status,error:e.error}))}))}resendVerificationCode(a){return this.http.post(`${this.apiUrl}/resend-verification`,{email:a}).pipe(o(t=>t),l(t=>{let e="Failed to resend verification code. Please try again.";return t.error&&(typeof t.error=="string"?e=t.error:t.error.message&&(e=t.error.message)),i(()=>({message:e,status:t.status}))}))}forgotPassword(a){return this.http.post(`${this.apiUrl}/forgot-password`,{email:a},{responseType:"text"}).pipe(o(t=>({message:t,success:!0})),l(t=>{let e="Failed to send password reset code. Please try again.";return t.error&&(typeof t.error=="string"?e=t.error:t.error.message&&(e=t.error.message)),i(()=>({message:e,status:t.status}))}))}resetPassword(a,t,e){return this.http.post(`${this.apiUrl}/reset-password`,{email:a,code:t,newPassword:e},{responseType:"text"}).pipe(o(s=>({message:s,success:!0})),l(s=>{let r="Failed to reset password. Please try again.";return s.error&&(typeof s.error=="string"?r=s.error:s.error.message&&(r=s.error.message)),i(()=>({message:r,status:s.status}))}))}getUserId(){return localStorage.getItem("userId")}getToken(){return localStorage.getItem("jwtToken")}getRole(){return localStorage.getItem("role")}logout(){localStorage.removeItem("jwtToken"),localStorage.removeItem("userId"),localStorage.removeItem("role"),localStorage.removeItem("username"),localStorage.removeItem("email")}static \u0275fac=function(t){return new(t||g)(u(f))};static \u0275prov=n({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();export{I as a};
