import{a as W,c as D,d as k,e as z,f as A,g as B,j as H,k as Y,l as j,m as q,n as R,q as G}from"./chunk-4JW6JOM3.js";import{e as V,g as L}from"./chunk-QFRFUNTU.js";import{$ as S,Ka as s,La as C,Xa as _,Za as g,Zb as F,_b as T,ab as t,ac as I,bb as n,c as w,cb as x,fb as O,ga as d,gb as b,ha as m,hb as v,lb as r,nb as u,ob as E,pb as f,qb as h,rb as M,tb as N,ub as P}from"./chunk-TON6CJEA.js";var J=()=>["01","02","03","04","05","06","07","08","09","10","11","12"],X=()=>["2025","2026","2027","2028","2029","2030"];function K(l,y){if(l&1&&(t(0,"option",32),r(1),n()),l&2){let i=y.$implicit;g("value",i),s(),u(" ",i," ")}}function Q(l,y){if(l&1&&(t(0,"option",32),r(1),n()),l&2){let i=y.$implicit;g("value",i),s(),u(" ",i," ")}}function U(l,y){if(l&1&&(t(0,"div",33),r(1),n()),l&2){let i=v();s(),u(" ",i.errorMessage," ")}}function Z(l,y){if(l&1&&(t(0,"div",34),r(1),n()),l&2){let i=v();s(),u(" ",i.successMessage," ")}}var re=(()=>{class l{route;router;plan;amountLabel="";cardNumber="";expiryMonth="";expiryYear="";cvv="";cardHolderName="";email="";saving=!1;errorMessage=null;successMessage=null;remainingSeconds=600;timerMinutes="10";timerSeconds="00";timerId;orderCode="";constructor(i,a){this.route=i,this.router=a}ngOnInit(){this.route.paramMap.subscribe(i=>{let a=i.get("plan");if(!a){this.router.navigate(["/pricing"]);return}this.plan=a,this.amountLabel=this.getAmountLabel(a)}),this.generateOrderCode(),this.startTimer()}ngOnDestroy(){this.timerId&&clearInterval(this.timerId)}getAmountLabel(i){switch(i){case"ONE_MONTH":return"30 DT";case"SIX_MONTHS":return"150 DT";case"ONE_YEAR":return"250 DT"}}onCardNumberInput(i){let a=i.target,p=(a.value.replace(/\D+/g,"").match(/.{1,4}/g)||[]).join(" ");this.cardNumber=p,a.value=p}startTimer(){this.updateTimerDisplay(),this.timerId=setInterval(()=>{this.remainingSeconds>0?(this.remainingSeconds--,this.updateTimerDisplay()):clearInterval(this.timerId)},1e3)}updateTimerDisplay(){let i=Math.floor(this.remainingSeconds/60),a=this.remainingSeconds%60;this.timerMinutes=i.toString().padStart(2,"0"),this.timerSeconds=a.toString().padStart(2,"0")}generateOrderCode(){let i=Date.now().toString().slice(-9),a=Math.floor(Math.random()*1e3).toString().padStart(3,"0");this.orderCode=`N\0b0${i}${a}ORDER001`}submit(){return w(this,null,function*(){this.errorMessage=null,this.successMessage=null;let i=localStorage.getItem("jwtToken");if(!i){this.router.navigate(["/login"]);return}if(!this.cardNumber||!this.expiryMonth||!this.expiryYear||!this.cvv||!this.cardHolderName||!this.email){this.errorMessage="Tous les champs sont obligatoires.";return}let a=this.cardNumber.replace(/\s+/g,"");if(!/^\d{16}$/.test(a)){this.errorMessage="Le num\xE9ro de carte doit contenir exactement 16 chiffres.";return}if(!/^\d{3}$/.test(this.cvv)){this.errorMessage="Le code de s\xFBret\xE9 doit contenir exactement 3 chiffres.";return}let e=a.slice(-4),c={plan:this.plan,amountLabel:this.amountLabel,cardLast4:e,expiryMonth:this.expiryMonth,expiryYear:this.expiryYear,cardHolderName:this.cardHolderName,email:this.email};this.saving=!0;try{if(!(yield fetch("http://localhost:8082/api/payments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(c)})).ok)throw new Error("Erreur lors de l'enregistrement du paiement.");this.successMessage="Vos informations de paiement ont \xE9t\xE9 enregistr\xE9es.",this.cardNumber=""}catch(p){this.errorMessage=p.message||"Erreur inconnue."}finally{this.saving=!1}})}static \u0275fac=function(a){return new(a||l)(C(V),C(L))};static \u0275cmp=S({type:l,selectors:[["app-payment-form"]],standalone:!0,features:[N],decls:63,vars:17,consts:[["paymentForm","ngForm"],[1,"ctp-wrapper"],[1,"ctp-card"],[1,"ctp-header"],[1,"ctp-logo-row"],[1,"ctp-logo-icon"],[1,"ctp-logo-text"],[1,"main"],[1,"ext"],[1,"sub"],[1,"ctp-body"],[1,"ctp-title"],[1,"ctp-order-number"],[1,"ctp-session-info"],[1,"ctp-form",3,"ngSubmit"],[1,"ctp-form-group"],[1,"ctp-input-with-icon"],[1,"icon"],["type","text","name","cardNumber","required","","placeholder","Num\xE9ro de la carte",3,"ngModelChange","input","ngModel"],[1,"ctp-form-row"],["name","expiryMonth",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["name","expiryYear",3,"ngModelChange","ngModel"],["type","password","name","cvv","maxlength","4","required","","placeholder","Code de s\xFBret\xE9",3,"ngModelChange","ngModel"],["type","text","name","cardHolderName","required","","placeholder","Le nom du d\xE9tenteur",3,"ngModelChange","ngModel"],[1,"ctp-email-label"],["type","checkbox","checked","","disabled",""],["type","email","name","email","required","","placeholder","exemple@domaine.com",3,"ngModelChange","ngModel"],["type","submit",1,"ctp-submit",3,"disabled"],["class","ctp-message error",4,"ngIf"],["class","ctp-message success",4,"ngIf"],[3,"value"],[1,"ctp-message","error"],[1,"ctp-message","success"]],template:function(a,e){if(a&1){let c=O();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),x(4,"div",5),t(5,"div",6)(6,"span",7),r(7,"ClicToPay"),n(),t(8,"span",8),r(9,".com.tn"),n(),x(10,"br"),t(11,"span",9),r(12,"by Mon\xE9tique Tunisie"),n()()()(),t(13,"div",10)(14,"h2",11),r(15,"Num\xE9ro de la commande"),n(),t(16,"div",12),r(17),n(),t(18,"div",13),r(19," Il reste jusqu'\xE0 la fin de la session "),t(20,"strong"),r(21),n()(),t(22,"form",14,0),b("ngSubmit",function(){return d(c),m(e.submit())}),t(24,"div",15)(25,"label"),r(26,"Num\xE9ro de la carte"),n(),t(27,"div",16)(28,"span",17),r(29,"\u{1F4B3}"),n(),t(30,"input",18),M("ngModelChange",function(o){return d(c),h(e.cardNumber,o)||(e.cardNumber=o),m(o)}),b("input",function(o){return d(c),m(e.onCardNumberInput(o))}),n()()(),t(31,"div",19)(32,"div",15)(33,"label"),r(34,"Mois"),n(),t(35,"select",20),M("ngModelChange",function(o){return d(c),h(e.expiryMonth,o)||(e.expiryMonth=o),m(o)}),t(36,"option",21),r(37,"Mois"),n(),_(38,K,2,2,"option",22),n()(),t(39,"div",15)(40,"label"),r(41,"Ann\xE9e"),n(),t(42,"select",23),M("ngModelChange",function(o){return d(c),h(e.expiryYear,o)||(e.expiryYear=o),m(o)}),t(43,"option",21),r(44,"Ann\xE9e"),n(),_(45,Q,2,2,"option",22),n()(),t(46,"div",15)(47,"label"),r(48,"Code de s\xFBret\xE9"),n(),t(49,"input",24),M("ngModelChange",function(o){return d(c),h(e.cvv,o)||(e.cvv=o),m(o)}),n()()(),t(50,"div",15)(51,"label"),r(52,"Le nom du d\xE9tenteur"),n(),t(53,"input",25),M("ngModelChange",function(o){return d(c),h(e.cardHolderName,o)||(e.cardHolderName=o),m(o)}),n()(),t(54,"div",15)(55,"label",26),x(56,"input",27),r(57," Adresse e-mail "),n(),t(58,"input",28),M("ngModelChange",function(o){return d(c),h(e.email,o)||(e.email=o),m(o)}),n()(),t(59,"button",29),r(60),n()(),_(61,U,2,1,"div",30)(62,Z,2,1,"div",31),n()()()}a&2&&(s(17),u(" ",e.orderCode," "),s(4),E("",e.timerMinutes," min. ",e.timerSeconds," sec."),s(9),f("ngModel",e.cardNumber),s(5),f("ngModel",e.expiryMonth),s(3),g("ngForOf",P(15,J)),s(4),f("ngModel",e.expiryYear),s(3),g("ngForOf",P(16,X)),s(4),f("ngModel",e.cvv),s(4),f("ngModel",e.cardHolderName),s(5),f("ngModel",e.email),s(),g("disabled",e.saving),s(),u(" Paiement ",e.amountLabel," "),s(),g("ngIf",e.errorMessage),s(),g("ngIf",e.successMessage))},dependencies:[I,F,T,G,B,Y,j,W,H,D,k,q,R,A,z],styles:[".ctp-wrapper[_ngcontent-%COMP%]{background-color:#f5f5f5;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding-top:40px;font-family:Arial,sans-serif}.ctp-card[_ngcontent-%COMP%]{width:520px;background-color:#fff;border-radius:4px;box-shadow:0 2px 8px #00000026}.ctp-header[_ngcontent-%COMP%]{padding:16px 24px 8px;border-bottom:1px solid #e0e0e0}.ctp-logo-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.ctp-logo-icon[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:4px;background:linear-gradient(135deg,#f57c00,#c62828)}.ctp-logo-text[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]{font-weight:700;color:#444}.ctp-logo-text[_ngcontent-%COMP%]   .ext[_ngcontent-%COMP%]{font-weight:700;color:#c62828}.ctp-logo-text[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:11px;color:#777}.ctp-body[_ngcontent-%COMP%]{padding:20px 24px 24px}.ctp-title[_ngcontent-%COMP%]{font-size:20px;margin:0 0 6px}.ctp-order-number[_ngcontent-%COMP%]{font-size:16px;font-weight:700;margin-bottom:6px}.ctp-session-info[_ngcontent-%COMP%]{font-size:13px;color:#555;margin-bottom:18px}.ctp-form[_ngcontent-%COMP%]{margin-top:8px}.ctp-form-group[_ngcontent-%COMP%]{margin-bottom:12px;display:flex;flex-direction:column}.ctp-form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;margin-bottom:4px}.ctp-input-with-icon[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid #cfcfcf;border-radius:3px;background-color:#fafafa}.ctp-input-with-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{padding:0 8px;color:#777}.ctp-input-with-icon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;flex:1;padding:8px;font-size:14px;background:transparent}.ctp-input-with-icon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.ctp-form-row[_ngcontent-%COMP%]{display:flex;gap:8px}.ctp-form-row[_ngcontent-%COMP%]   .ctp-form-group[_ngcontent-%COMP%]{flex:1}input[type=text][_ngcontent-%COMP%], input[type=email][_ngcontent-%COMP%], input[type=password][_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:8px;border-radius:3px;border:1px solid #cfcfcf;font-size:14px}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2;box-shadow:0 0 0 1px #1976d233}.ctp-email-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px}.ctp-submit[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;border-radius:3px;background-color:#0052cc;color:#fff;font-weight:600;font-size:15px;cursor:pointer;margin-top:8px}.ctp-submit[disabled][_ngcontent-%COMP%]{opacity:.7;cursor:default}.ctp-message[_ngcontent-%COMP%]{margin-top:10px;font-size:13px}.ctp-message.error[_ngcontent-%COMP%]{color:#c62828}.ctp-message.success[_ngcontent-%COMP%]{color:#2e7d32}"]})}return l})();export{re as PaymentFormComponent};
